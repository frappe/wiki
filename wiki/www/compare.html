{% extends "wiki/doctype/wiki_page/templates/wiki_doc.html" %}

{%- block head_include %}
{{ super() }}
{{ include_style('wiki.bundle.css') }}
{% endblock -%}

{% block page_content %}
    <div class="from-markdown">
        <h1>{{ title }}</h1>
        <h2 style="display: inline;">{{ revision.message }}</h2>
    	<div class='btn btn-primary restore-wiki-revision'>Restore Revision</div>
        <p class="wiki-revision-meta">
            {{ revision.raised_by_username or revision.owner }} edited on {{ frappe.utils.format_datetime(revision.creation, 'medium') }}
        </p>
    </div>
    <div class="mt-6">
        <div class="wiki-diff">
            {{ diff or 'No changes to show' }}
        </div>
    </div>

<script>
    frappe.ready(() => {
        $(".restore-wiki-revision").click(() => {
            const url = new URL(window.location.href);
            const wikiRevisionName = url.searchParams.get('compare')
            const wikiPageName = url.searchParams.get('wiki_page')

            frappe.call({
				method: "wiki.www.compare.restore_wiki_revision",
                args: {
                    wiki_revision_name: wikiRevisionName,
                    wiki_page_name: wikiPageName
                }
            })
        })
    })
</script>

{% endblock %}


{%- block navbar -%}
{% include "wiki/doctype/wiki_page/templates/wiki_navbar.html" %}

{%- endblock -%}

