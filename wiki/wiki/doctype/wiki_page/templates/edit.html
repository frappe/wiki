<span class="h2">{{ title }}</span>
<span class='btn btn-xs btn-primary submit pull-right'>Submit</div>

	<form class="mt-8" action="/api/method/wiki.wiki.doctype.wiki_page.wiki_page.update" method="POST">
		<input class="d-none" type="text" name="csrf_token" value="{{ frappe.session.csrf_token }}">
		<input class="d-none" type="text" name="wiki_page" value="{{ doc.name }}">
		<input class="d-none" type="text" name="wiki_page_patch" value="{{ wiki_page_patch or ''}}">
		<input class="d-none" type="text" name="new" value="{{ frappe.form_dict.new or ''}}">
		<div class="form-group">
			<label class="sr-only" for="title_of_page">Title</label>
			<input  class="form-control" type="text" name="title_of_page" value="{{ doc.title }}">
		</div>
		<div class="form-group">
			<label class="sr-only" for="content">Content</label>
			<ul class="nav nav-tabs" role="tablist">
				<li class="nav-item" role="presentation">
					<a {% if not wiki_page_patch %} class="nav-link active" {% else %} class="nav-link" {% endif %}
						id="write-tab" data-toggle="tab" href="#write" role="tab" aria-controls="write"
						aria-selected="true">Write</a>
				</li>
				<li class="nav-item" role="presentation">
					<a class="nav-link" id="preview-tab" data-toggle="tab" href="#preview" role="tab"
						aria-controls="preview" aria-selected="false">Preview</a>
				</li>
				{%- if not frappe.form_dict.new -%}

				<li class="nav-item" role="presentation">
					<a class="nav-link" id="diff-tab" data-toggle="tab" href="#diff" role="tab" aria-controls="diff"
						aria-selected="false">Compare</a>
				</li>
				{%- endif -%}
				<li class="nav-item" role="presentation">
					<a class="nav-link" id="attachment-tab" data-toggle="tab" href="#attachment" role="tab"
						aria-controls="attachment" aria-selected="false">Attachment</a>
				</li>
				{% if wiki_page_patch %}

				<li class="nav-item" role="presentation">
					<a {% if wiki_page_patch %} class="nav-link active" {% else %} class="nav-link" {% endif %}
						id="discussion-tab" data-toggle="tab" href="#discussion" role="tab" aria-controls="discussion"
						aria-selected="false">Discussion</a>
				</li>
				{% endif %}
			</ul>
			<div class="mt-4 tab-content">
				<div {% if not wiki_page_patch %} class="tab-pane fade show active" {% else %} class="tab-pane fade" {%
					endif %} id="write" role="tabpanel" aria-labelledby="write-tab">
					<textarea id="content" class="form-control wiki-content" name="content" rows="30"
						hidden>{{ doc.content }}</textarea>
					<div class="wiki-write"></div>
				</div>
				<div class="tab-pane fade" id="preview" role="tabpanel" aria-labelledby="preview-tab">
					<div class="from-markdown wiki-preview"></div>
				</div>

				{%- if not frappe.form_dict.new -%}
				<div class="tab-pane fade" id="diff" role="tabpanel" aria-labelledby="preview-tab">
					<div class="from-markdown wiki-diff"></div>
				</div>
				{%- endif -%}

				<div class="tab-pane fade" id="attachment" role="tabpanel" aria-labelledby="attachment-tab">
					<div class="wiki-attachment"></div>
					<br>
					<span class='btn add-attachment'>Upload Attachment</span>
				</div>

				{% if wiki_page_patch %}

				<div {% if wiki_page_patch %} class="tab-pane fade show active" {% else %} class="tab-pane fade" {%
					endif %} id="discussion" role="tabpanel" aria-labelledby="discussion-tab">

					{% include "wiki/doctype/wiki_page/templates/comment.html" %}



				</div>
				{% endif %}
			</div>

		</div>


		</div>
	</form>



	{% block base_scripts %}
	<!-- js should be loaded in body! -->
	<script type="text/javascript" src="/assets/frappe/js/lib/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/js/frappe-web.min.js"></script>
	<script type="text/javascript" src="/assets/js/control.min.js"></script>
	<script type="text/javascript" src="/assets/js/dialog.min.js"></script>
	<script type="text/javascript" src="/assets/js/bootstrap-4-web.min.js"></script>
	<script type="text/javascript" src="/assets/js/moment-bundle.min.js"></script>
	<script type="text/javascript" src="/assets/frappe/node_modules/vue/dist/vue.js"></script>
	<script type="text/javascript" src="/assets/wiki/js/wiki.min.js"></script>
	<script>
		// console.log("comments")
		// console.log({{ comments or ''}})
		Vue.prototype.__ = window.__;
		Vue.prototype.frappe = window.frappe;
		var edit = new EditAsset();
	</script>

	<!-- <script>
	frappe.ready(() => {
		$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
			let activeTab = $(e.target);

			if (activeTab.prop('id') === 'preview-tab') {
				let content = $('textarea#content').val();
				let $preview = $('.wiki-preview');
				$preview.html('Loading preview...');
				frappe.call('wiki.wiki.doctype.wiki_page.wiki_page.preview', { content })
					.then(r => {
						if (r.message) {
							$preview.html(r.message);
						}
					});
			}
		})
	})
</script> -->
	{% endblock %}