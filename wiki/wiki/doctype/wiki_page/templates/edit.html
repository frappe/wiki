<span class="h2">{{ title }}</span>
<span class='btn btn-xs btn-primary submit pull-right'>Submit</div>

	<form class="mt-8" action="/api/method/wiki.wiki.doctype.wiki_page.wiki_page.update" method="POST">
		<input class="d-none" type="text" name="csrf_token" value="{{ frappe.session.csrf_token }}">
		<input class="d-none" type="text" name="wiki_page" value="{{ doc.name }}">
		<input class="d-none" type="text" name="wiki_page_patch" value="{{ wiki_page_patch or ''}}">
		<div class="form-group">
			<label class="sr-only" for="title">Title</label>
			<input id="title" class="form-control" type="text" name="title" value="{{ doc.title }}">
		</div>
		<div class="form-group">
			<label class="sr-only" for="content">Content</label>
			<ul class="nav nav-tabs" role="tablist">
				<li class="nav-item" role="presentation">
					<a class="nav-link active" id="write-tab" data-toggle="tab" href="#write" role="tab"
						aria-controls="write" aria-selected="true">Write</a>
				</li>
				<li class="nav-item" role="presentation">
					<a class="nav-link" id="preview-tab" data-toggle="tab" href="#preview" role="tab"
						aria-controls="preview" aria-selected="false">Preview</a>
				</li>
				<li class="nav-item" role="presentation">
					<a class="nav-link" id="diff-tab" data-toggle="tab" href="#diff" role="tab" aria-controls="diff"
						aria-selected="false">Compare</a>
				</li>
				<li class="nav-item" role="presentation">
					<a class="nav-link" id="attachment-tab" data-toggle="tab" href="#attachment" role="tab"
						aria-controls="attachment" aria-selected="false">Attachment</a>
				</li>
				<li class="nav-item" role="presentation">
					<a class="nav-link" id="discussion-tab" data-toggle="tab" href="#discussion" role="tab"
						aria-controls="discussion" aria-selected="false">Discussion</a>
				</li>
			</ul>
			<div class="mt-4 tab-content">
				<div class="tab-pane fade show active" id="write" role="tabpanel" aria-labelledby="write-tab">
					<textarea id="content" class="form-control wiki-content" name="content" rows="30"
						hidden>{{ doc.content }}</textarea>
					<div class="wiki-write"></div>
				</div>
				<div class="tab-pane fade" id="preview" role="tabpanel" aria-labelledby="preview-tab">
					<div class="from-markdown wiki-preview"></div>
				</div>
				<div class="tab-pane fade" id="diff" role="tabpanel" aria-labelledby="preview-tab">
					<div class="from-markdown wiki-diff"></div>
				</div>
				<div class="tab-pane fade" id="attachment" role="tabpanel" aria-labelledby="attachment-tab">
					<div class="wiki-attachment"></div>
					<br>
					<span class='btn add-attachment'>Upload Attachment
				</div>


				<div class="tab-pane fade" id="discussion" role="tabpanel" aria-labelledby="discussion-tab">

					<div class="comment-section">
						<div class="new-timeline">
							<div class="timeline-items">

								{% for comment in comments %}
								<div class="timeline-item">

									<div class="timeline-content frappe-card">
										<div class="timeline-message-box">

											<span class="flex justify-between">
												<span class="text-color flex">
													<span>
														{{comment.owner }}
														<span class="text-muted margin-left">
															<span class="frappe-timestamp "
																data-timestamp="2021-05-17 23:18:49.550835"
																title="17-05-2021 23:18:49">{{comment.creation}} </span>
														</span>
													</span>
												</span>
											</span>
											<div class="content">
												{{comment.content}}
											</div>


										</div>
									</div>
								</div>

								{% endfor %}

							</div>
						</div>
					</div>


				</div>
			</div>

		</div>

		<!-- <label class="font-size-sm" for="edit_message">Edit Message</label>
		<input id="edit_message" class="form-control form-control-sm" type="text" name="edit_message"
			placeholder="Write a small message here explaining this change"> -->


		</div>
		<!-- <button type="submit" class="btn btn-primary">Save Page</button> -->

		<!-- </div> -->
		<!-- <div class="form-group"> -->
		<!-- <label class="font-size-sm" for="edit_message">Edit Message</label>
			<input id="edit_message" class="form-control form-control-sm" type="text" name="edit_message" placeholder="Write a small message here explaining this change"> -->
		<!-- <button type="submit" class="btn btn-primary">Save Page</button> -->
		<!-- </form> -->
	</form>

	<!-- {%- block script -%}
{%- endblock -%} -->


	{% block base_scripts %}
	<!-- js should be loaded in body! -->
	<script type="text/javascript" src="/assets/frappe/js/lib/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="/assets/js/frappe-web.min.js"></script>
	<script type="text/javascript" src="/assets/js/desk.min.js"></script>
	<script type="text/javascript" src="/assets/css/desk.min.css"></script>
	<script type="text/javascript" src="/assets/js/control.min.js"></script>
	<script type="text/javascript" src="/assets/js/dialog.min.js"></script>
	<script type="text/javascript" src="/assets/js/bootstrap-4-web.min.js"></script>
	<script src="/editu.js"></script>
	<script type="text/javascript" src="/assets/js/moment-bundle.min.js"></script>
	<script type="text/javascript" src="/assets/frappe/node_modules/vue/dist/vue.js"></script>
	<script>
		// console.log("comments")
		// console.log({{ comments or ''}})
		Vue.prototype.__ = window.__;
		Vue.prototype.frappe = window.frappe;
	</script>

	<!-- <script>
	frappe.ready(() => {
		$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
			let activeTab = $(e.target);

			if (activeTab.prop('id') === 'preview-tab') {
				let content = $('textarea#content').val();
				let $preview = $('.wiki-preview');
				$preview.html('Loading preview...');
				frappe.call('wiki.wiki.doctype.wiki_page.wiki_page.preview', { content })
					.then(r => {
						if (r.message) {
							$preview.html(r.message);
						}
					});
			}
		})
	})
</script> -->
	{% endblock %}